{% extends 'base.html.twig' %}

{% block title %}Notre Carte ‚Äî Vite & Gourmand{% endblock %}

{% block body %}
<div class="container" style="max-width: 1200px; margin: 2rem auto; padding: 2rem;">
    <h1 style="font-size:2.2rem;font-weight:700;margin-bottom:0.5rem;">üçΩÔ∏è Notre Carte</h1>
    <p style="color:#6b7280;margin-bottom:3rem;">D√©couvrez nos menus de traiteur et la composition de chaque plat.</p>

    {# ‚îÄ‚îÄ MENUS ‚îÄ‚îÄ #}
    {% if menus %}
        <div class="category-section" style="margin-bottom: 4rem;">
            <h2 style="border-bottom: 2px solid var(--primary-color); padding-bottom: 0.5rem; display: inline-block; margin-bottom: 2rem;">
                üéâ Nos Menus
            </h2>
            <div class="products-grid" style="padding: 0;">
                {% for menu in menus %}
                    <div class="product-card glass" style="border: 2px solid var(--primary-color);">
                        <div class="product-details">
                            <h3>{{ menu.name }}</h3>
                            <p>{{ menu.description }}</p>
                            <ul style="list-style: none; padding: 0; margin: 1rem 0;">
                                {% for product in menu.products %}
                                    <li style="padding: 0.2rem 0; color: #6B7280; font-size: 0.9rem;">‚Ä¢ {{ product.name }}</li>
                                {% endfor %}
                            </ul>
                            <div style="display: flex; gap: 1rem; margin-bottom: 0.75rem; flex-wrap: wrap;">
                                {% if menu.minPeople %}
                                    <span style="background: rgba(16,185,129,0.15); color: var(--primary-color); font-size: 0.8rem; padding: 0.2rem 0.6rem; border-radius: 999px; font-weight: 600;">üë• Min. {{ menu.minPeople }} pers.</span>
                                {% endif %}
                                {% if menu.stock is not null %}
                                    <span style="background: {% if menu.stock > 0 %}rgba(16,185,129,0.15){% else %}rgba(239,68,68,0.15){% endif %}; color: {% if menu.stock > 0 %}var(--primary-color){% else %}#EF4444{% endif %}; font-size: 0.8rem; padding: 0.2rem 0.6rem; border-radius: 999px; font-weight: 600;">
                                        {% if menu.stock > 0 %}üì¶ {{ menu.stock }} dispo.{% else %}‚ùå √âpuis√©{% endif %}
                                    </span>
                                {% endif %}
                            </div>
                            <div class="product-price">{{ menu.price }} ‚Ç¨<span style="font-size:0.8rem;font-weight:400;color:#9ca3af;"> / pers.</span></div>
                            <a href="{{ path('app_menu_show', {'id': menu.id}) }}" class="btn btn-primary" style="width: 100%; margin-top: 1rem; display: block; text-align: center;">Voir le d√©tail &amp; Commander ‚Üí</a>
                        </div>
                    </div>
                {% endfor %}
            </div>
        </div>
    {% endif %}

    {# ‚îÄ‚îÄ PLATS PAR CAT√âGORIE (informatif seulement) ‚îÄ‚îÄ #}
    <div style="background:rgba(99,102,241,0.05);border:1px solid rgba(99,102,241,0.15);border-radius:1rem;padding:1.25rem;margin-bottom:2rem;">
        <p style="margin:0;color:#6b7280;font-size:0.9rem;">‚ÑπÔ∏è Les plats ci-dessous sont pr√©sent√©s √† titre informatif. Ils font partie de nos menus. Pour commander, s√©lectionnez un menu ci-dessus.</p>
    </div>

    {% for category, products in groupedProducts %}
        <div class="category-section" style="margin-bottom: 4rem;">
            <h2 style="border-bottom: 2px solid var(--primary-color); padding-bottom: 0.5rem; display: inline-block; margin-bottom: 2rem;">
                {% if category == 'starter' %}ü•ó Entr√©es
                {% elseif category == 'main' %}üçΩÔ∏è Plats principaux
                {% elseif category == 'dessert' %}üç∞ Desserts
                {% elseif category == 'drink' %}ü•§ Boissons
                {% else %}{{ category|capitalize }}s{% endif %}
            </h2>

            <div class="products-grid" style="padding: 0;">
                {% for product in products %}
                    <div class="product-card glass">
                        <img src="https://placehold.co/400x300?text={{ product.name|url_encode }}" alt="{{ product.name }}" class="product-image">
                        <div class="product-details">
                            <h3>{{ product.name }}</h3>
                            <p>{{ product.description }}</p>

                            {% if product.diets|length > 0 %}
                            <div style="display:flex;flex-wrap:wrap;gap:0.3rem;margin-bottom:0.5rem;">
                                {% for diet in product.diets %}
                                    <span style="background:rgba(16,185,129,0.15);color:#059669;padding:0.2rem 0.5rem;border-radius:12px;font-size:0.75rem;font-weight:600;">üåø {{ diet.name }}</span>
                                {% endfor %}
                            </div>
                            {% endif %}

                            {% if product.allergens|length > 0 %}
                            <div style="display:flex;flex-wrap:wrap;gap:0.3rem;margin-bottom:0.5rem;">
                                {% for allergen in product.allergens %}
                                    <span style="background:rgba(239,68,68,0.12);color:#dc2626;padding:0.2rem 0.5rem;border-radius:12px;font-size:0.75rem;font-weight:600;">‚ö†Ô∏è {{ allergen.name }}</span>
                                {% endfor %}
                            </div>
                            {% endif %}

                            <div class="product-price">{{ product.price }} ‚Ç¨</div>
                            <p style="font-size:0.8rem;color:#9ca3af;margin-top:0.75rem;font-style:italic;">Disponible dans nos menus</p>
                        </div>
                    </div>
                {% endfor %}
            </div>
        </div>
    {% else %}
        <p>Aucun plat disponible pour le moment.</p>
    {% endfor %}
</div>
{% endblock %}

